# Design Use Cases

## D7 (v2) [[Updated from D7 (v1)]](../sprint_3)

1. **Title**: Init Receiver (InitRx)
2. **Purpose**: To allow a remote endpoint to start a new simulation
3. **Actors**: Simulation Engine, Remote Endpoint
4. **Preconditions**:
    - The simulation engine is connected to a message queue service such as RabbitMQ
5. **Main Flow**:
    - Remote endpoint publishes a new init message to the init queue
    - The simulation engine reads the message from the init queue
    - The simulation engine deserializes the init message into a simulation `Config`
    - The simulation engine starts a new simulation with the provided `Config`
    - The simulation engine attaches a metrics transmitter to the simulation instance (to forward aggregated metrics to the remote endpoint)
    - _The simulation engine attaches an event transmitter to the simulation instance (to forward some select events generated by the simulation as a feedback mechanism to the remote endpoint)_
    - The simulation engine attaches a command receiver to the simulation instance (so that the remote endpoint can send commands to the simulation and interact with it)
6. **Alternative Flow**:
    - the remote endpoint sends an invalid init message
    - the simulation engine silently drops the message and continues
7. **Postcondition**:
    - A new simulation instance is running

### Tests

1. Test that InitRx receives init messages from remote endpoint

    - create new InitRx
    - attach closured callback function to the receiver by calling the OnReceive method
    - send an init message to the queue init receiver is listening on
    - assert that the closured callback function receives the init message as expected

## D12 (v1)

1. **Title**: Event Transmitter (EventTx)
2. **Purpose**: To forward select events from a simulation's event log to remote endpoints to serve as feedback messages
3. **Actors**: Simulation Engine, Remote Endpoint
4. **Preconditions**:
    - The simulation engine is connected to a message queue service such as RabbitMQ
    - The event transmitter is subscribed to the running simulation's event log
5. **Main Flow**:
    - The simulation instance produces events to the log
    - the event transmitter listens for events that serve as feedback messages to remote endpoints, such as `SimulationInitialized` and `CommandProcessed` events
    - the event transmitter forwards feedback events to the client
    - the remote endpoint receives feedback events
6. **Postcondition**:
    - There are no side-effects from this flow

### Tests

1. Test that EventTx transmits events to remote endpoint

    - create new EventTx bound to a test queue
    - create a mock remote endpoint that consumes from a test queue that event tx will publish to
    - send an event message to the test queue
    - assert that the mock remote endpoint receives the event message as expected
