# Design Use Cases

## D7 (v2) [[Updated from D7 (v1)]](../sprint_3)

**Title:** Init Receiver (InitRx)
**Purpose:** To allow a remote endpoint to start a new simulation
**Actors:** Simulation Engine, Remote Endpoint
**Preconditions:** The simulation engine is connected to a message queue service such as RabbitMQ
**Main Flow:**
- Remote endpoint publishes a new init message to the init queue
- The simulation engine reads the message from the init queue
- The simulation engine deserializes the init message into a simulation `Config`
- The simulation engine starts a new simulation with the provided `Config`
- The simulation engine attaches a metrics transmitter to the simulation instance (to forward aggregated metrics to the remote endpoint)
- _The simulation engine attaches an event transmitter to the simulation instance (to forward some select events generated by the simulation as a feedback mechanism to the remote endpoint)_
- The simulation engine attaches a command receiver to the simulation instance (so that the remote endpoint can send commands to the simulation and interact with it)
**Alternative Flow:**
- The remote endpoint sends an invalid init message
- The simulation engine silently drops the message and continues
**Postcondition:** A new simulation instance is running

### Tests

    1. Test that InitRx receives init messages from remote endpoint:
    
        - Create new InitRx.
        - Attach closured callback function to the receiver by calling the OnReceive method.
        - send an init message to the queue init receiver is listening on.
        - assert that the closured callback function receives the init message as expected.

---

### D11 (v2) [[Updated from D11 (v2)]](../sprint_3)

1. **Title**: Manage game messages
2. **Purpose**: Connect a Sim engine instance to the UI displayed to a User
3. **Actors**: Api Server
4. **Preconditions**:
    - A game has been created and UI is using STOMP via connected websocket
    - RabbitMQ is running and connected to API Server
5. **Main Flow**:
    - API Server listens to the appropriate Rabbit Queue for game _notifications_ and when a message is received forward via a STOMP endpoint using the sim UUID
    - API Server listens to game commands STOMP endpoint and forwards message to appropriate Rabbit Exchange using sim UUID
6. **Postcondition**:
    - Game _notification_ messages are forwarded to UI
    - Game command messages are forwarded to Sim via Rabbit

### Tests

1. Test _Notification_ messages are consumed from Rabbit and sent to UI
    - create required Rabbit structures (Exchanges/Queues)
    - mock a _notification_ message in the appropriate queue
    - assert message is consumed and received by UI

2. Test Command messages are received and sent to Rabbit
    - create required Rabbit structures (Exchanges/Queues)
    - mock a command sent to command STOMP endpoint
    - assert message is sent to appropriate Rabbit queue

## D14 (v1)

**Title:** Event Transmitter (EventTx)
**Purpose:** To forward select events from a simulation's event log to remote endpoints to serve as feedback messages
**Actors:** Simulation Engine, Remote Endpoint
**Preconditions:**
- The simulation engine is connected to a message queue service such as RabbitMQ
- The event transmitter is subscribed to the running simulation's event log
**Main Flow:**
- The simulation instance produces events to the log
- the event transmitter listens for events that serve as feedback messages to remote endpoints, such as `SimulationInitialized` and `CommandProcessed` events
- the event transmitter forwards feedback events to the client
- the remote endpoint receives feedback events
**Postcondition:**
- There are no side-effects from this flow

### Tests

    1. Test that EventTx transmits events to remote endpoint:

        - Create new EventTx bound to a test queue.
        - Create a mock remote endpoint that consumes from a test queue that event tx will publish to.
        - Send an event message to the test queue.
        - Assert that the mock remote endpoint receives the event message as expected.
